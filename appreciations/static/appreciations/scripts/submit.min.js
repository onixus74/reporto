"use strict";reform||(window.reform={data:{},urls:{},widgets:{}}),reform.widgets.map={},reform.widgets.map.init=function(){var a=reform.widgets.map,b=a.object=L.map("map");b.setView([34.161818161230386,9.3603515625],5),L.control.scale().addTo(b),b.setMaxBounds(b.getBounds()),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{}).addTo(b);var c=new L.Control.GeoSearch({provider:new L.GeoSearch.Provider.Google({region:"tn"}),zoomLevel:16});b.addControl(c),a.geoSearch=c;var d,e=$("#id_latitude"),f=$("#id_longitude"),g=$("#id_location");b.on("click ",function(a){console.log("widget","map","latlng",a.latlng),d?(console.log("widget","map","marker",d),d.setLatLng(a.latlng)):(d=L.marker(a.latlng,{draggable:!0}),d.addTo(b),d.on("dragend",function(a){var b=""+a.target._latlng.lat+","+a.target._latlng.lng;e.val(a.target._latlng.lat),f.val(a.target._latlng.lng),g.val(b).change()})),e.val(a.latlng.lat),f.val(a.latlng.lng),g.val(""+a.latlng.lat+","+a.latlng.lng).change()})},Dropzone.autoDiscover=!1,reform.widgets.dropzone={},reform.widgets.dropzone.init=function(){var a=reform.widgets.dropzone;a.object=new Dropzone("#ui-media-file-upload",{url:"/",paramName:"files",maxFilesize:10,uploadMultiple:!0,autoProcessQueue:!1,addRemoveLinks:!0,acceptedFiles:"image/*",dictDefaultMessage:"Drop files or click to upload photos"})},$(document).ready(reform.widgets.dropzone.init),reform.widgets.wizard={},reform.widgets.wizard.init=function(){function a(a){var b=100*(a+1)/(g.length-1);console.log("progress",b,a,g.length),e.progressBar.css({width:b+"%"})}function b(b,c,d){function e(c){console.log("element",this),console.log("target",c.target);var h=e.fields;console.log("fields",h),h[this.name]=!0,console.log("fields",h);var i=Object.keys(h).reduce(function(a,b){return a&&h[b]},!0);if(console.log("ready",i),i){var j,k=g.indexOf(b),l=g[k+1];j=Array.isArray(l)?l.map(function(a){return f[a]}):f[l],console.log("section",b,f[b]),console.log("next section",l,j),j&&(Array.isArray(j)?j.forEach(function(a){$(a).addClass("animated fadeIn").show()}):j.addClass("animated fadeIn").show()),a(k),d&&d()}$(this).off("change.showNextSection")}return e.fields={},c.forEach(function(a){e.fields[a]=!1}),e}function c(a,c,d){var f=b(a,c,d);c.forEach(function(a){e[a].on("change.showNextSection",f)})}var d=reform.widgets.wizard;$("#id_category option[selected]").removeAttr("selected").html(""),$(".select2").selectpicker(),d.form=$("#appreciation-form");var e=d.elements={};d.inputs={};var f=d.sections={category:$("#ui-wizard-category"),"location-datetime":$("#ui-wizard-location-datetime"),"description-media":$("#ui-wizard-description-media"),submit:$("#ui-wizard-submit")},g=d.order=["category","location-datetime",["description-media","submit"]];console.log(f),e.progressBar=$("#ui-wizard-progress"),Array.prototype.slice.apply(document.querySelector("#appreciation-form").elements).forEach(function(a){e[a.name]=$(a)}),e.category=$("#id_category"),c("category",["category"],reform.widgets.map.init),e.latitude=$("#id_latitude"),e.longitude=$("#id_longitude"),e.location=$("#id_location"),e.location_text=$("#id_location_text"),e.datetime=$("#id_datetime"),e.date=$("#id_date"),e.time=$("#id_time"),c("location-datetime",["location","location_text","datetime"]),e.location.on("change",function(){var a=e.location_text;console.log(this.value);var b=this.value.split(",");console.log(b);var c=parseFloat(b[0],10),d=parseFloat(b[1],10),f=new google.maps.Geocoder;f.geocode({location:new google.maps.LatLng(c,d),region:"tn"},function(b,c){if(c==google.maps.GeocoderStatus.OK){for(var d=[],e=0;e<b.length;e++)d.push(b[e].formatted_address);console.log(d),d.length>0&&a.val(d[0]).change()}})}),e.description=$("#id_description"),$("#appreciation-form").on("submit",function(a){a.preventDefault(),$(".appreciation-violation-form").block({message:"<h3>Processing ...</h3>"});for(var b=new FormData(this),c=reform.widgets.dropzone.object.files,d=0;d<c.length;d++){var e=c[d];console.log(e),b.append("files[]",e)}return $.ajax({type:"POST",url:reform.urls.submit,data:b,processData:!1,contentType:!1,headers:{"X-CSRFToken":csrf_token}}).done(function(a){setTimeout(function(){window.location=a.url},500),$.pnotify({title:a.notification.title,text:a.notification.body,type:"success",nonblock:!0})}).fail(function(a){console.log(a);var b=a.responseJSON;$.pnotify({title:b.notification.title,text:b.errors.__all_?b.errors.__all__.join("<br>"):b.notification.body,type:"error"}),$(".appreciation-violation-form").unblock()}),!1})},$(document).ready(reform.widgets.wizard.init),reform.widgets.datetime={},reform.widgets.datetime.init=function(){function a(){var a=f.val(),b=g.val();b&&a&&h.val(b+" "+a).trigger("change")}function b(){i.previousYear()}function c(){i.nextYear()}var d=reform.widgets.datetime,e=reform.widgets.wizard.elements,f=e.time,g=e.date,h=e.datetime;f.on("change",a),g.on("change",a);var i;i=d.object=$("#dateinput").clndr({template:$("#dateinput-template").html().split(/\n|\r/gi).map(function(a){return a.trim()}).join(""),adjacentDaysChangeMonth:!0,clickEvents:{click:function(a){console.log(a),a.date._f&&(g.val(a.date._i).change(),$("#dateinput .day.selected").removeClass("selected"),$(a.element).addClass("selected"))}},doneRendering:function(){console.log("doneRendering",this),i&&(i.element.find(".clndr-previous-year-button").off("click").on("click",b),i.element.find(".clndr-next-year-button").off("click").on("click",c))}}),i.element.find(".clndr-previous-year-button").off("click").on("click",b),i.element.find(".clndr-next-year-button").off("click").on("click",c)},$(document).ready(reform.widgets.datetime.init);
//# sourceMappingURL=/static/appreciations/scripts/submit.min.js.map