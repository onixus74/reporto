"use strict";reform||(window.reform={data:{},urls:{},widgets:{}}),reform.widgets.map={},reform.widgets.map.init=function(){var a=reform.widgets.map,b=a.object=L.map("map");b.setView([34.161818161230386,9.3603515625],5),L.control.scale().addTo(b),b.setMaxBounds(b.getBounds()),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{}).addTo(b);var c=new L.Control.GeoSearch({provider:new L.GeoSearch.Provider.Google({region:"tn"}),zoomLevel:16});b.addControl(c),a.geoSearch=c;var d,e=$("#id_latitude"),f=$("#id_longitude"),g=$("#id_location");b.on("click ",function(a){console.log("widget","map","latlng",a.latlng),d?(console.log("widget","map","marker",d),d.setLatLng(a.latlng)):(d=L.marker(a.latlng,{draggable:!0}),d.addTo(b),d.on("dragend",function(a){var b=""+a.target._latlng.lat+","+a.target._latlng.lng;e.val(a.target._latlng.lat),f.val(a.target._latlng.lng),g.val(b).change()})),e.val(a.latlng.lat),f.val(a.latlng.lng),g.val(""+a.latlng.lat+","+a.latlng.lng).change()})},Dropzone.autoDiscover=!1,reform.widgets.dropzone={},reform.widgets.dropzone.init=function(){var a=reform.widgets.dropzone;a.object=new Dropzone("#ui-media-file-upload",{url:"/",paramName:"files",maxFilesize:10,uploadMultiple:!0,autoProcessQueue:!1,addRemoveLinks:!0,acceptedFiles:"image/*",dictDefaultMessage:"Drop files or click to upload photos"})},$(document).ready(reform.widgets.dropzone.init),reform.widgets.wizard={},reform.widgets.wizard.init=function(){function a(a){var b=100*(a+1)/(h.length-1);console.log("progress",b,a,h.length),f.progressBar.css({width:b+"%"})}function b(){var b=$(this);f.reporterState.html(b.data("value")).addClass(b.data("class")).addClass("animated pulse"),g["victim-witness"].addClass("animated fadeOut").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).hide(),g.category.addClass("animated fadeIn").show()}),a(0),f.victimButton.off("click"),f.witnessButton.off("click")}function c(b,c,d){function e(c){console.log("element",this),console.log("target",c.target);var f=e.fields;console.log("fields",f),f[this.name]=!0,console.log("fields",f);var i=Object.keys(f).reduce(function(a,b){return a&&f[b]},!0);if(console.log("ready",i),i){var j,k=h.indexOf(b),l=h[k+1];j=Array.isArray(l)?l.map(function(a){return g[a]}):g[l],console.log("section",b,g[b]),console.log("next section",l,j),j&&(Array.isArray(j)?j.forEach(function(a){$(a).addClass("animated fadeIn").show()}):j.addClass("animated fadeIn").show()),a(k),d&&d()}$(this).off("change.showNextSection")}return e.fields={},c.forEach(function(a){e.fields[a]=!1}),e}function d(a,b,d){var e=c(a,b,d);b.forEach(function(a){f[a].on("change.showNextSection",e)})}var e=reform.widgets.wizard;$("#id_category option[selected]").removeAttr("selected").html(""),$(".select2").selectpicker(),e.form=$("#report-form");var f=e.elements={};e.inputs={},f.reporterState=$("#ui-wizard-reporter-state");var g=e.sections={"victim-witness":$("#ui-wizard-victim-witness-buttons"),category:$("#ui-wizard-category"),"location-datetime":$("#ui-wizard-location-datetime"),"victim-aggressor":$("#ui-wizard-victim-aggressor"),"description-media":$("#ui-wizard-description-media"),"sources-media-links":$("#ui-wizard-sources-media-links"),features:$("#ui-wizard-features"),submit:$("#ui-wizard-submit")},h=e.order=["victim-witness","category","location-datetime",["victim-aggressor","description-media","sources-media-links","features","submit"]];console.log(g),f.progressBar=$("#ui-wizard-progress"),f.victimButton=$("#ui-wizard-victim-button"),f.victimButtonContainer=$("#ui-wizard-victim-button-container"),f.witnessButton=$("#ui-wizard-witness-button"),f.witnessButtonContainer=$("#ui-wizard-witness-button-container"),f.victimButton.on("click",function(a){b.call(this,a),$("#ui-wizard-victim-text").show(),$("#id_victim").val("user").change(),$("#ui-reporter-victim-fieldset").show().removeAttr("disabled"),$("#ui-witness-victim-label").show(),$("#ui-reporter-victim-label").hide()}),f.witnessButton.on("click",function(a){b.call(this,a),$("#ui-wizard-witness-text").show(),$("#id_victim").val("0").change(),$("#ui-witness-victim-fieldset").show().removeAttr("disabled")}),Array.prototype.slice.apply(document.querySelector("#report-form").elements).forEach(function(a){f[a.name]=$(a)}),f.category=$("#id_category"),d("category",["category"],reform.widgets.map.init),f.latitude=$("#id_latitude"),f.longitude=$("#id_longitude"),f.location=$("#id_location"),f.location_text=$("#id_location_text"),f.datetime=$("#id_datetime"),f.date=$("#id_date"),f.time=$("#id_time"),d("location-datetime",["location","location_text","datetime"]),f.location.on("change",function(){var a=f.location_text;console.log(this.value);var b=this.value.split(",");console.log(b);var c=parseFloat(b[0],10),d=parseFloat(b[1],10),e=new google.maps.Geocoder;e.geocode({location:new google.maps.LatLng(c,d),region:"tn"},function(b,c){if(c==google.maps.GeocoderStatus.OK){for(var d=[],e=0;e<b.length;e++)d.push(b[e].formatted_address);console.log(d),d.length>0&&a.val(d[0]).change()}})}),f.victim=$("#id_victim"),f.aggressor=$("#id_aggressor"),f.description=$("#id_description"),f.sourcesList=$("#ui-sources-list"),f.sourcesSourceInput=$("#ui-sources-source-input"),f.sourcesUrlInput=$("#ui-sources-url-input"),f.sourcesAddButton=$("#ui-sources-add-button");var i=$("#ui-sources-list-item").html();f.sourcesAddButton.on("click",function(a){a.preventDefault();var b=f.sourcesSourceInput.val(),c=f.sourcesUrlInput.val();if(!b)return f.sourcesSourceInput.focus(),void 0;if(!c||!f.sourcesUrlInput.get(0).checkValidity())return f.sourcesUrlInput.focus(),void 0;var d=$(_.template(i,{source:b,url:c,value:"["+b+"]("+c+")"}));f.sourcesList.append(d),d.find(".ui-sources-remove-button").on("click",function(a){a.preventDefault(),d.remove()}),f.sourcesSourceInput.val(null),f.sourcesUrlInput.val(null),f.sourcesSourceInput.focus()}),f.linksList=$("#ui-links-list"),f.linksUrlInput=$("#ui-links-url-input"),f.linksAddButton=$("#ui-links-add-button");var j=$("#ui-links-list-item").html();f.linksAddButton.on("click",function(a){a.preventDefault();var b=f.linksUrlInput.val();if(!b||!f.linksUrlInput.get(0).checkValidity())return f.linksUrlInput.focus(),void 0;var c=$(_.template(j,{url:b}));f.linksList.append(c),c.find(".ui-links-remove-button").on("click",function(a){a.preventDefault(),c.remove()}),f.linksUrlInput.val(null),f.linksUrlInput.focus()}),f.features=$("#id_features"),$("#report-form").on("submit",function(a){a.preventDefault(),$(".report-violation-form").block({message:"<h3>Processing ...</h3>"});for(var b=new FormData(this),c=reform.widgets.dropzone.object.files,d=0;d<c.length;d++){var e=c[d];console.log(e),b.append("files[]",e)}return $.ajax({type:"POST",url:reform.urls.submit,data:b,processData:!1,contentType:!1,headers:{"X-CSRFToken":csrf_token}}).done(function(a){setTimeout(function(){window.location=a.url},500),$.pnotify({title:a.notification.title,text:a.notification.body,type:"success",nonblock:!0})}).fail(function(a){console.log(a);var b=a.responseJSON;$.pnotify({title:b.notification.title,text:b.errors.__all_?b.errors.__all__.join("<br>"):b.notification.body,type:"error"}),$(".report-violation-form").unblock()}),!1})},$(document).ready(reform.widgets.wizard.init),reform.widgets.datetime={},reform.widgets.datetime.init=function(){function a(){var a=f.val(),b=g.val();b&&a&&h.val(b+" "+a).trigger("change")}function b(){i.previousYear()}function c(){i.nextYear()}var d=reform.widgets.datetime,e=reform.widgets.wizard.elements,f=e.time,g=e.date,h=e.datetime;f.on("change",a),g.on("change",a);var i;i=d.object=$("#dateinput").clndr({template:$("#dateinput-template").html().split(/\n|\r/gi).map(function(a){return a.trim()}).join(""),adjacentDaysChangeMonth:!0,clickEvents:{click:function(a){console.log(a),a.date._f&&(g.val(a.date._i).change(),$("#dateinput .day.selected").removeClass("selected"),$(a.element).addClass("selected"))}},doneRendering:function(){console.log("doneRendering",this),i&&(i.element.find(".clndr-previous-year-button").off("click").on("click",b),i.element.find(".clndr-next-year-button").off("click").on("click",c))}}),i.element.find(".clndr-previous-year-button").off("click").on("click",b),i.element.find(".clndr-next-year-button").off("click").on("click",c)},$(document).ready(reform.widgets.datetime.init),reform.widgets.similarReports={},reform.widgets.similarReports.init=function(){function a(){c||(d.hide(),e.css({display:"inline-block"}).addClass("animated pulse").show(),c=!0);var a=new FormData(document.querySelector("#report-form"));return $("#ui-reports-list").block({message:"Loading ..."}),$.ajax({type:"POST",url:reform.urls.similar,data:a,processData:!1,contentType:!1,dataType:"json",headers:{"X-CSRFToken":csrf_token}}).done(function(a){g.html(a.html).find("#ui-no-similar-reports").addClass("animated fadeInUp").show().css("display","block"),g.find("#ui-no-reports").hide(),$("#ui-reports-list").unblock()}).fail(function(a){console.log(a)}),void 0}var b=reform.widgets.similarReports,c=!1,d=$("#ui-latest-reports-label"),e=$("#ui-similar-reports-label"),f=($("#ui-no-similar-reports"),$("#ui-no-reports")),g=$("#ui-reports-list"),h=g.find(".ui-similar-report-candidate");f.addClass("animated fadeInUp").show().css("display","block"),window.similarReports=b,b.reportsList=g,b.reportsItems=h;var i=reform.widgets.wizard.elements,i=reform.widgets.wizard.elements;i.location.on("change",a),i.date.on("change",a),i["victim-firstname"].on("change",a),i["victim-lastname"].on("change",a)},$(document).ready(reform.widgets.similarReports.init);
//# sourceMappingURL=/static/violations/scripts/submit.min.js.map