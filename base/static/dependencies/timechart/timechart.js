/*!
    --------------------------------------
    timechart v1.3
    --------------------------------------
    Copyright 2013 - FrÃ©dÃ©ric Worm
    timechart may not distributed and only used with authorization of the author
    --------------------------------------
*/
window.Timechart=function(t,e){var a=function(){var t={};t.isFunction=function(t){return"function"==typeof t},t.max=function(t,e,a){if(!e&&_.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.max.apply(Math,t);if(!e&&_.isEmpty(t))return-1/0;var i={computed:-1/0,value:-1/0};return t.forEach(function(t,s,n){var o=e?e.call(a,t,s,n):t;o>=i.computed&&(i={value:t,computed:o})}),i.value},t.min=function(t,e,a){if(!e&&_.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.min.apply(Math,t);if(!e&&_.isEmpty(t))return 1/0;var i={computed:1/0,value:1/0};return t.forEach(function(t,s,n){var o=e?e.call(a,t,s,n):t;i.computed>o&&(i={value:t,computed:o})}),i.value};var e=function(t){return"function"==typeof t?t:function(e){return e[t]}};return t.pluck=function(t,e){return t.map(function(t){return t[e]})},t.sortBy=function(a,i,s){var n=e(i);return t.pluck(a.map(function(t,e,a){return{value:t,index:e,criteria:n.call(s,t,e,a)}}).sort(function(t,e){var a=t.criteria,i=e.criteria;if(a!==i){if(a>i||void 0===a)return 1;if(i>a||void 0===i)return-1}return t.index<e.index?-1:1}),"value")},t.extend=function(e){var a=t.clone(e);return Array.prototype.slice.call(arguments,1).forEach(function(t){if(t)for(var e in t)a[e]=t[e]}),a},t.clone=function(t){return JSON.parse(JSON.stringify(t))},t}(),i={id:"timegraph",width:!1,height:!1,sheight:!1,limit:1e3,zoom:"3m",aggregate:!1,startFilter:!1,aggregateZeros:!1,aggregateLastValueStays:!1,autoScale:!0,autoMaxScale:!1,autoMinScale:!1,maxScaleBounds:!1,minScaleBounds:!1,maxScaleForce:!1,minScaleForce:!1,datefield:"d",dateformat:!1,datafields:["a","b","c","d","e","f","g","h"],aggregators:["avg","avg","avg","avg","avg","avg","avg","avg"],unit:!1,linecolors:["#77e","#e7e","#7e7","#7ee","#777","#ee7","#e77","#7e0"],dotcolors:["#22c","#c2c","#2c2","#2cc","#222","#cc2","#c22","#2c0"],dotsize:2,monthnames:["january","february","march","april","mai","june","july","august","september","october","november","december"],loadingText:"loading...",lines:!0,smooth:.5,dots:!0,timemargin:"",setToNow:!1,colors:{background:"#fff",selectionLine:"#a00",selectionText:"#000",scale1:"#000",scale2:"#888",scale3:"#aaa",scale4:"#f0f0f0",overlay:"#000",overlayOpacity:.2,overlayBorder:"#000"}},s=a.extend(i,t);t.colors&&(s.colors=a.extend(i.colors,t.colors));var n={_dataworker:null,_rawdata:[],_data:[],_ddata:[],_w:0,_h:0,_sh:0,_container:null,_mgcanvas:null,_mgctx:null,_mgocanvas:null,_mgoctx:null,_sgcanvas:null,_sgctx:null,_sgocanvas:null,_sgoctx:null,_dc:"",_actFrom:0,_actTo:0,_minT:0,_maxT:0,_actPan:!1,_zoomValue:0,_dataFinished:function(){},_init:function(){var t=this;if(document.createElement("canvas").getContext&&Blob&&Worker&&(window.webkitURL||window.URL)&&atob){var a="ZnVuY3Rpb24gZGVidWcoZSl7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZToiZGVidWciLG1zZzplfSl9ZnVuY3Rpb24gZGF5c0luTW9udGgoZSx0KXt2YXIgYT0zMTtyZXR1cm4oND09ZXx8Nj09ZXx8OT09ZXx8MTE9PWUpJiYoYT0zMCksMj09ZSYmKGE9MjgsMD09dCU0JiYoYT0yOSksMD09dCUxMDAmJihhPTI5KSwwPT10JTQwMCYmKGE9MjkpKSxhfXZhciBtbD1mdW5jdGlvbigpe3ZhciBlPXt9O2UuaXNGdW5jdGlvbj1mdW5jdGlvbihlKXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgZX0sZS5tYXg9ZnVuY3Rpb24oZSx0LGEpe2lmKCF0JiZfLmlzQXJyYXkoZSkmJmVbMF09PT0rZVswXSYmNjU1MzU+ZS5sZW5ndGgpcmV0dXJuIE1hdGgubWF4LmFwcGx5KE1hdGgsZSk7aWYoIXQmJl8uaXNFbXB0eShlKSlyZXR1cm4tMS8wO3ZhciByPXtjb21wdXRlZDotMS8wLHZhbHVlOi0xLzB9O3JldHVybiBlLmZvckVhY2goZnVuY3Rpb24oZSxuLHUpe3ZhciBjPXQ/dC5jYWxsKGEsZSxuLHUpOmU7Yz49ci5jb21wdXRlZCYmKHI9e3ZhbHVlOmUsY29tcHV0ZWQ6Y30pfSksci52YWx1ZX0sZS5taW49ZnVuY3Rpb24oZSx0LGEpe2lmKCF0JiZfLmlzQXJyYXkoZSkmJmVbMF09PT0rZVswXSYmNjU1MzU+ZS5sZW5ndGgpcmV0dXJuIE1hdGgubWluLmFwcGx5KE1hdGgsZSk7aWYoIXQmJl8uaXNFbXB0eShlKSlyZXR1cm4gMS8wO3ZhciByPXtjb21wdXRlZDoxLzAsdmFsdWU6MS8wfTtyZXR1cm4gZS5mb3JFYWNoKGZ1bmN0aW9uKGUsbix1KXt2YXIgYz10P3QuY2FsbChhLGUsbix1KTplO3IuY29tcHV0ZWQ+YyYmKHI9e3ZhbHVlOmUsY29tcHV0ZWQ6Y30pfSksci52YWx1ZX07dmFyIHQ9ZnVuY3Rpb24oZSl7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIGU/ZTpmdW5jdGlvbih0KXtyZXR1cm4gdFtlXX19O3JldHVybiBlLnBsdWNrPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUubWFwKGZ1bmN0aW9uKGUpe3JldHVybiBlW3RdfSl9LGUuc29ydEJ5PWZ1bmN0aW9uKGEscixuKXt2YXIgdT10KHIpO3JldHVybiBlLnBsdWNrKGEubWFwKGZ1bmN0aW9uKGUsdCxhKXtyZXR1cm57dmFsdWU6ZSxpbmRleDp0LGNyaXRlcmlhOnUuY2FsbChuLGUsdCxhKX19KS5zb3J0KGZ1bmN0aW9uKGUsdCl7dmFyIGE9ZS5jcml0ZXJpYSxyPXQuY3JpdGVyaWE7aWYoYSE9PXIpe2lmKGE+cnx8dm9pZCAwPT09YSlyZXR1cm4gMTtpZihyPmF8fHZvaWQgMD09PXIpcmV0dXJuLTF9cmV0dXJuIGUuaW5kZXg8dC5pbmRleD8tMToxfSksInZhbHVlIil9LGUuZXh0ZW5kPWZ1bmN0aW9uKHQpe3ZhciBhPWUuY2xvbmUodCk7cmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKS5mb3JFYWNoKGZ1bmN0aW9uKGUpe2lmKGUpZm9yKHZhciB0IGluIGUpYVt0XT1lW3RdfSksYX0sZS5jbG9uZT1mdW5jdGlvbihlKXtyZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlKSl9LGV9KCk7c2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIixmdW5jdGlvbihlKXt0cnl7dmFyIHQ9ZS5kYXRhLmRhdGEsYT1lLmRhdGEuY2ZnO3Q9bWwuc29ydEJ5KHQsZnVuY3Rpb24oZSl7cmV0dXJuIGUuZH0pO3ZhciByPW1sLm1pbih0LGZ1bmN0aW9uKGUpe3JldHVybiBlLmR9KSxuPW1sLm1heCh0LGZ1bmN0aW9uKGUpe3JldHVybiBlLmR9KSx1PTA7c3dpdGNoKGEuYWdncmVnYXRlKXtjYXNlInkiOnU9MzE1MzZlNjticmVhaztjYXNlIm0iOnU9MjY3ODRlNTticmVhaztjYXNlInciOmJyZWFrO2Nhc2UiZCI6dT04NjRlNTticmVhaztjYXNlImgiOnU9MzZlNTticmVhaztjYXNlIm1pbiI6dT02ZTR9dmFyIGM9TWF0aC5yb3VuZCgobmV3IERhdGUobi5kKS5nZXRUaW1lKCktbmV3IERhdGUoci5kKS5nZXRUaW1lKCkpL3UpLGk9YS5saW1pdDtpZihjPmkpe3ZhciBzPW5ldyBEYXRlKG4uZCkuZ2V0VGltZSgpLXUqaTtyPW1sLm1pbih0LGZ1bmN0aW9uKGUpe3JldHVybiBlLmQ+cz9lLmQ6MS8wfSl9dmFyIG89bmV3IERhdGUoci5kKS5nZXRUaW1lKCksZz1uZXcgRGF0ZShuLmQpLmdldFRpbWUoKSxkPW5ldyBEYXRlKHIuZCkuZ2V0RnVsbFllYXIoKSxsPW5ldyBEYXRlKHIuZCkuZ2V0TW9udGgoKSsxLGY9bmV3IERhdGUoci5kKS5nZXREYXRlKCksbT1uZXcgRGF0ZShyLmQpLmdldEhvdXJzKCksdj1uZXcgRGF0ZShyLmQpLmdldE1pbnV0ZXMoKSxoPW5ldyBEYXRlKG4uZCkuZ2V0RnVsbFllYXIoKSxwPW5ldyBEYXRlKG4uZCkuZ2V0TW9udGgoKSsxLHc9bmV3IERhdGUobi5kKS5nZXREYXRlKCkseT1uZXcgRGF0ZShuLmQpLmdldEhvdXJzKCksYj1uZXcgRGF0ZShuLmQpLmdldE1pbnV0ZXMoKTtzd2l0Y2goYS5hZ2dyZWdhdGUpe2Nhc2UieSI6cD0wLHc9MCx5PTAsYj0wLGw9MCxmPTAsbT0wLHY9MDticmVhaztjYXNlIm0iOnc9MCx5PTAsYj0wLGY9MCxtPTAsdj0wO2JyZWFrO2Nhc2UidyI6YnJlYWs7Y2FzZSJkIjp5PTAsYj0wLG09MCx2PTA7YnJlYWs7Y2FzZSJoIjpiPTAsdj0wO2JyZWFrO2Nhc2UibWluIjp9Zm9yKHZhciBrPVtdLEQ9e30sTT0hMDtNOyl7dmFyIHg9dC5maWx0ZXIoZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IERhdGUoZS5kKTtzd2l0Y2goYS5hZ2dyZWdhdGUpe2Nhc2UieSI6cmV0dXJuIHQuZ2V0RnVsbFllYXIoKT09ZDtjYXNlIm0iOnJldHVybiB0LmdldE1vbnRoKCkrMT09bCYmdC5nZXRGdWxsWWVhcigpPT1kO2Nhc2UidyI6Y2FzZSJkIjpyZXR1cm4gdC5nZXRNb250aCgpKzE9PWwmJnQuZ2V0RnVsbFllYXIoKT09ZCYmdC5nZXREYXRlKCk9PWY7Y2FzZSJoIjpyZXR1cm4gdC5nZXRNb250aCgpKzE9PWwmJnQuZ2V0RnVsbFllYXIoKT09ZCYmdC5nZXREYXRlKCk9PWYmJnQuZ2V0SG91cnMoKT09bTtjYXNlIm1pbiI6cmV0dXJuIHQuZ2V0TW9udGgoKSsxPT1sJiZ0LmdldEZ1bGxZZWFyKCk9PWQmJnQuZ2V0RGF0ZSgpPT1mJiZ0LmdldEhvdXJzKCk9PW0mJnQuZ2V0TWludXRlcygpPT12fXJldHVybiExfSksRj1bXTtzd2l0Y2goYS5kYXRhZmllbGRzLmZvckVhY2goZnVuY3Rpb24oZSx0KXt2YXIgcj1hLmFnZ3JlZ2F0b3JzW3RdLG49MCx1PXgucmVkdWNlKGZ1bmN0aW9uKGUsYSl7cmV0dXJuIGEudlt0XSE9PXZvaWQgMD8obisrLGUrYS52W3RdKTplfSwwKTsiYXZnIj09ciYmKHgubGVuZ3RoPjAmJm4/dS89bjp1PTApLDA9PW4mJmEuYWdncmVnYXRlTGFzdFZhbHVlU3RheXMmJihGW3RdPURbdF0/RFt0XTp1KSwobj4wfHxhLmFnZ3JlZ2F0ZVplcm9zKSYmKEZbdF09dSxEW3RdPXUpfSksYS5hZ2dyZWdhdGUpe2Nhc2UieSI6bD03LGY9MSxtPTAsdj0wO2JyZWFrO2Nhc2UibSI6Zj0xNSxtPTAsdj0wO2JyZWFrO2Nhc2UidyI6YnJlYWs7Y2FzZSJkIjptPTEyLHY9MDticmVhaztjYXNlImgiOnY9MzA7YnJlYWs7Y2FzZSJtaW4iOn1zd2l0Y2goay5wdXNoKHtkOm5ldyBEYXRlKGQsbC0xLGYsbSx2LDApLmdldFRpbWUoKSx2OkZ9KSxNPWg+ZHx8ZD09aCYmcD5sfHxkPT1oJiZsPT1wJiZ3PmZ8fGQ9PWgmJmw9PXAmJmY9PXcmJnk+bXx8ZD09aCYmbD09cCYmZj09dyYmbT09eSYmYj52PyEwOiExLGEuYWdncmVnYXRlKXtjYXNlInkiOmQrKzticmVhaztjYXNlIm0iOmwrKzticmVhaztjYXNlInciOmJyZWFrO2Nhc2UiZCI6ZisrO2JyZWFrO2Nhc2UiaCI6bSsrO2JyZWFrO2Nhc2UibWluIjp2Kyt9NjA9PXYmJih2PTAsbSsrKSwyND09bSYmKG09MCxmKyspLGY9PWRheXNJbk1vbnRoKGwsZCkrMSYmKGY9MSxsKyspLDEzPT1sJiYobD0xLGQrKyl9c2VsZi5wb3N0TWVzc2FnZSh7dHlwZToiZGF0YSIsZGF0YTprLG1pblQ6byxtYXhUOmd9KX1jYXRjaChlKXtkZWJ1ZyhlLnN0YWNrKTt2YXIgVD1lLnN0YWNrLnJlcGxhY2UoL15bXlwoXSs/W1xuJF0vZ20sIiIpLnJlcGxhY2UoL15ccythdFxzKy9nbSwiIikucmVwbGFjZSgvXk9iamVjdC48YW5vbnltb3VzPlxzKlwoL2dtLCJ7YW5vbnltb3VzfSgpQCIpLnNwbGl0KCJcbiIpO2RlYnVnKGUrIlxuIitUKX19LCExKTs=",i=window.webkitURL?window.webkitURL:window.URL;return this._dataworker=new Worker(i.createObjectURL(new Blob([atob(a)]))),this._generateDateRegEx(),this._container=document.getElementById(s.id),this._mgcanvas=document.createElement("canvas"),this._mgocanvas=document.createElement("canvas"),this._sgcanvas=document.createElement("canvas"),this._sgocanvas=document.createElement("canvas"),this._mgctx=this._mgcanvas.getContext("2d"),this._mgoctx=this._mgocanvas.getContext("2d"),this._sgctx=this._sgcanvas.getContext("2d"),this._sgoctx=this._sgocanvas.getContext("2d"),this._container.appendChild(this._mgcanvas),this._container.appendChild(this._mgocanvas),this._container.appendChild(this._sgcanvas),this._container.appendChild(this._sgocanvas),this.resize(),this._mgocanvas.addEventListener("mousemove",function(e){t._mousemoveMg(e)}),this._mgocanvas.addEventListener("mouseout",function(){t._mgoctx.clearRect(-1,-1,t._mgocanvas.width+2,t._mgocanvas.height+2)}),window.addEventListener("mousemove",function(e){t._mousemoveSg(e)}),this._sgocanvas.addEventListener("mousedown",function(e){t._startPan(e)}),window.addEventListener("mouseup",function(e){t._stopPan(e)}),this._dataworker.addEventListener("message",function(e){var a=e.data;"debug"==a.type?console.log(a.msg):"data"==a.type?t._dataFinished(a):"progress"==a.type},!1),e&&this.setData(e),!0}return!1},changeConfig:function(t){var e=this,i=s,n=Math.round((this._actTo-this._actFrom)/2+this._actFrom);s=a.extend(s,t),i.aggregate!=s.aggregate||!i.aggregators&&s.aggregators||i.aggregators&&!s.aggregators||i.aggregators&&s.aggregators&&i.aggregators.join(".")!=s.aggregators.join(".")||i.dateformat!=s.dateformat||i.datefield!=s.datefield||i.datafields.join(".")!=s.datafields.join(".")||i.aggregateZeros!=s.aggregateZeros?this.setData(this._rawdata,function(){e.setActTime(n)}):(this._generateDateRegEx(),this.resize(),this.setActTime(n))},_redraw:function(){this._actLoading?this._drawLoadingMessage():(this._drawGraph(this._sgcanvas,this._sgctx),this._drawSOverlay(this._sgocanvas,this._sgoctx),this._drawGraph(this._mgcanvas,this._mgctx,!0))},resize:function(){s.width?(this._w=s.width,this._container.style.width=this._w+"px"):this._w=this._container.offsetWidth,s.height?(this._h=s.height,this._container.style.height=this._h+"px"):this._h=this._container.offsetHeight,this._sh=s.sheight?s.sheight:Math.floor(.2*this._h),this._container.style.position&&""!=this._container.style.position&&"static"!=this._container.style.position||(this._container.style.position="relative"),this._container.style.lineHeight=0,this._mgcanvas.style.margin=0,this._mgcanvas.style.padding=0,this._mgocanvas.style.margin=0,this._mgocanvas.style.padding=0,this._sgcanvas.style.margin=0,this._sgcanvas.style.padding=0,this._sgocanvas.style.margin=0,this._sgocanvas.style.padding=0,this._mgcanvas.width=this._w,this._mgcanvas.height=this._h-this._sh-5,this._mgocanvas.width=this._w,this._mgocanvas.height=this._h-this._sh-5,this._mgcanvas.style.position="absolute",this._mgcanvas.style.top=0,this._mgcanvas.style.left=0,this._mgocanvas.style.position="absolute",this._mgocanvas.style.top=0,this._mgocanvas.style.left=0,this._sgcanvas.width=this._w,this._sgcanvas.height=this._sh,this._sgcanvas.style.position="absolute",this._sgcanvas.style.top=this._h-this._sh+"px",this._sgcanvas.style.left=0,this._sgocanvas.width=this._w,this._sgocanvas.height=this._sh,this._sgocanvas.style.position="absolute",this._sgocanvas.style.top=this._h-this._sh+"px",this._sgocanvas.style.left=0,this._sgocanvas.style.zIndex=1,this._sgocanvas.style.cursor="pointer",this._mgctx.translate(.5,.5),this._mgoctx.translate(.5,.5),this._sgctx.translate(.5,.5),this._sgoctx.translate(.5,.5),this._redraw()},_getMouse:function(t,e){if(t){var a,i,s=e,n=0,o=0;if(s.offsetParent!==void 0)do n+=s.offsetLeft,o+=s.offsetTop;while(s=s.offsetParent);return a=t.pageX-n,i=t.pageY-o,{x:a,y:i}}return{x:0,y:0}},_startPan:function(t){this._actPan=!0,this._sgocanvas.style.cursor="move",this._mousemoveSg(t)},_stopPan:function(){this._actPan=!1,this._sgocanvas.style.cursor="pointer"},_timeDefinitionToTimestamp:function(t){var e=0,a=t.match(/([0-9]*)([a-z]*)/),i=a[1];""===i&&(i="1"),i=parseInt(i);var s=a[2];switch(s){case"y":e=31536e6;break;case"m":e=2592e6;break;case"w":e=6048e5;break;case"d":e=864e5;break;case"h":e=36e5;break;case"min":case"i":e=6e4;break;case"s":case"sec":e=1e3}return e*i},setActTime:function(t){var e=this._timeDefinitionToTimestamp(s.zoom);this._zoomValue=e,this._actFrom=Math.floor(t-e/2),this._actFrom<this._minT&&(this._actFrom=this._minT),this._actTo=Math.floor(this._actFrom+e),this._actTo>this._maxT&&(this._actTo=this._maxT,this._actFrom=Math.floor(this._maxT-e)),this._redraw()},_panInterval:null,_mousemoveSg:function(t){var e=this;if(this._actPan){var a=this._getMouse(t,this._sgocanvas),i=this._sgocanvas.width/(this._maxT-this._minT),s=-(this._minT*this._sgocanvas.width)/(this._maxT-this._minT),n=(a.x-s)/i;this.setActTime(n),this._drawSOverlay(this._sgocanvas,this._sgoctx),this._panInterval&&clearTimeout(this._panInterval),this._panInterval=setTimeout(function(){e._drawGraph(e._mgcanvas,e._mgctx,!0)},1)}},_selInterval:null,_mousemoveMg:function(t){var e=this,i=e._getMouse(t,e._mgocanvas);this._selInterval&&clearTimeout(this._selInterval),this._selInterval=setTimeout(function(){var t=e._mgocanvas.width/(e._actTo-e._actFrom),s=-(e._actFrom*e._mgocanvas.width)/(e._actTo-e._actFrom),n=(i.x-s)/t,o=a.min(e._ddata,function(t){return Math.abs(t.d-n)});o&&o.v&&e._drawSelection(o)},1)},_drawSelection:function(t){var e=this._mgoctx,i=this._mgocanvas.width,n=this._mgocanvas.height;if(e.clearRect(-1,-1,this._mgocanvas.width+2,this._mgocanvas.height+2),t.v.length>0){var o=i/(this._actTo-this._actFrom),r=-(this._actFrom*i)/(this._actTo-this._actFrom),c=Math.round(t.d*o+r);e.lineWidth=1,e.strokeStyle=s.colors.selectionLine,e.beginPath(),e.moveTo(c,-1),e.lineTo(c,n),e.stroke();var l,h=new Date(t.d),d=function(t){return 1==(""+t).length?"0"+t:t};"string"==typeof s.dateformat?(l=s.dateformat,l=l.replace(/y+/g,h.getFullYear()),l=l.replace(/m+/g,d(h.getMonth()+1)),l=l.replace(/d+/g,d(h.getDate())),l=l.replace(/h+/g,d(h.getHours())),l=l.replace(/i+/g,d(h.getMinutes())),l=l.replace(/s+/g,d(h.getSeconds()))):l=h.toLocaleString(),e.strokeStyle=s.colors.background,e.fillStyle=s.colors.selectionText,e.lineWidth=3;var m=0;e.measureText(l).width+5+c>=i&&(m=e.measureText(l).width+10),e.strokeText(l,c+5-m,12),e.fillText(l,c+5-m,12);var u=[];t.v.forEach(function(t,e){"number"==typeof t&&u.push({v:Math.round(t),c:s.dots?s.dotcolors[e]:s.linecolors[e]})}),u=a.sortBy(u,function(t){return-t.v});var g=s.unit?" "+s.unit:"";u.forEach(function(t,a){e.strokeStyle=s.colors.background,e.fillStyle=t.c,e.lineWidth=3;var i=0;m&&(i=e.measureText(t.v+g).width+10),e.strokeText(t.v+g,c+5-i,15*a+30),e.fillText(t.v+g,c+5-i,15*a+30)})}},_dateRegEx:null,_dateValues:null,_generateDateRegEx:function(){if("string"==typeof s.dateformat){var t="",e=[],a=/([dmyhis]*)([^dmyhis]*)/g;do{var i=a.exec(s.dateformat),n=i[1],o=i[2];/(^d+$)|(^m+$)|(^y+$)|(^h+$)|(^i+$)|(^s+$)/.test(n)?(e.push(n.charAt(0)),t+="(\\d+)"):t+=n,t+=o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}while(""!=i[1]||""!=i[2]);this._dateRegEx=RegExp(t),this._dateValues=e}else this._dateRegEx=!1},_parseDate:function(t){if("object"==typeof t&&t.getTime)return t;if(this._dateRegEx){var e={d:1,m:1,y:1,h:0,i:0,s:0},a=t.match(this._dateRegEx);return this._dateValues.forEach(function(t,i){e[t]=a[i+1]}),new Date(e.y,e.m-1,e.d,e.h,e.i,e.s)}return new Date(t)},_actLoading:!1,setData:function(t,e){var a=this;this._rawdata=t,this._data=[],t.forEach(function(t){var e=a._parseDate(t[s.datefield]),i=[];(!s.startFilter||e.getTime()>a._parseDate(s.startFilter).getTime())&&(s.datafields.forEach(function(e){i.push(t[e])}),a._data.push({d:e,v:i}))}),s.aggregate?(this._mgctx.clearRect(-1,-1,this._mgcanvas.width+2,this._mgcanvas.height+2),this._sgctx.clearRect(-1,-1,this._sgcanvas.width+2,this._sgcanvas.height+2),this._sgoctx.clearRect(-1,-1,this._sgocanvas.width+2,this._sgocanvas.height+2),this._drawLoadingMessage(),this._actLoading=!0,this._dataFinished=function(t){a._actLoading=!1,a._ddata=t.data,a._calcBoundariesFromData(),a.setActTime(a._maxT),e&&e()},this._dataworker.postMessage({data:this._data,cfg:s})):(this._prepareData(),this.setActTime(this._maxT),e&&e())},_prepareData:function(){var t=a.sortBy(this._data,function(t){return t.d}),e=s.limit;t.length>e&&(t=t.slice(t.length-e)),this._ddata=t,this._calcBoundariesFromData()},_calcBoundariesFromData:function(){var t=this._ddata,e=t[0],a=t[t.length-1];if(this._minT=new Date(e.d).getTime(),this._maxT=new Date(a.d).getTime(),s.timemargin){var i=this._timeDefinitionToTimestamp(s.timemargin);this._maxT+=i,this._minT-=i}1==t.length&&(this.setActTime(t[0].d),this._maxT=t[0].d+this._zoomValue/2,this._minT=t[0].d-this._zoomValue/2),s.setToNow&&(this._maxT=Date.now())},_drawLoadingMessage:function(){this._mgctx.strokeStyle=s.colors.background,this._mgctx.fillStyle=s.colors.scale2;var t=Math.floor(this._mgcanvas.width/2)-20,e=Math.floor(this._mgcanvas.height/2);this._mgctx.strokeText(s.loadingText,t,e),this._mgctx.fillText(s.loadingText,t,e)},_daysInMonth:function(t,e){var a=31;return(4==t||6==t||9==t||11==t)&&(a=30),2==t&&(a=28,0==e%4&&(a=29),0==e%100&&(a=29),0==e%400&&(a=29)),a},_drawGraph:function(t,e,a){var i=this;e.clearRect(-1,-1,t.width+2,t.height+2),e.font="normal 12px Arial";var n=this._ddata;if(a){var o=5,r=this._ddata.length-1,c=0;this._ddata.forEach(function(t,e){t.d>=i._actFrom&&t.d<=i._actTo&&(e>c&&(c=e),r>e&&(r=e))}),n=this._ddata.filter(function(t,e){return e>=r-o&&c+o>=e})}var l,h;l=s.autoMaxScale||s.autoScale?n:this._ddata,h=s.autoMinScale||s.autoScale?n:this._ddata;var d=-999999999;l.forEach(function(t){t.v.forEach(function(t){t>d&&(d=t)})});var m=999999999;if(h.forEach(function(t){t.v.forEach(function(t){m>t&&(m=t)})}),m==d){var u=.1*Math.abs(m);m-=u,d+=u}s.maxScaleBounds!==!1&&d>s.maxScaleBounds&&(d=s.maxScaleBounds),s.minScaleBounds!==!1&&s.minScaleBounds>m&&(m=s.minScaleBounds),s.minScaleForce!==!1&&(m=s.minScaleForce),s.maxScaleForce!==!1&&(d=s.maxScaleForce);var g=this._minT,_=this._maxT;a&&(g=this._actFrom,_=this._actTo);var f=t.width,v=f/(_-g),Z=-(g*f)/(_-g),p=5,y=60;a||(y=5,p=5);var b=t.height,T=p+y,x=b-y,w=-((b-T)/(d-m)),S=(d*b-d*p-m*y)/(d-m)-(y-p),Y=this._minT,X=this._maxT;a&&(Y=this._actFrom,X=this._actTo);var W=new Date(Y).getFullYear(),k=new Date(X).getFullYear();e.lineWidth=1;var G,K=!1,R=!1,F=!1,M=!1,V=!1,L=!1,E=!1,I=!1;G=a?this._actTo-this._actFrom:this._maxT-this._minT,2592e5>=G?(K=s.colors.scale1,R=s.colors.scale2,L=s.colors.scale2,F=s.colors.scale3,E=s.colors.scale3,M=s.colors.scale4,I=s.colors.scale3):5184e6>=G?(K=s.colors.scale1,R=s.colors.scale2,L=s.colors.scale2,F=s.colors.scale4,E=s.colors.scale3):2592e7>=G?(K=s.colors.scale1,R=s.colors.scale2,L=s.colors.scale2):63072e6>=G?(K=s.colors.scale2,V=s.colors.scale2,R=s.colors.scale3):63072e7>=G&&(K=s.colors.scale2,V=s.colors.scale2),a||(V=!1,L=!1,E=!1,I=!1);for(var J=18,P=W;k>=P;P++)if(K){if(R)for(var N=1;12>=N;N++){if(F)for(var U=864e5*v,C=1;this._daysInMonth(N,P)>=C;C++){if(M)for(var D=36e5*v,j=0;23>=j;j++){var z=Math.round(new Date(P,N-1,C,j,0,0).getTime()*v+Z);z>0&&t.width>z&&(e.lineWidth=1,e.strokeStyle=M,e.beginPath(),e.moveTo(z,-1),e.lineTo(z,x+J+4),e.stroke(),a&&D>20&&(e.strokeStyle=s.colors.background,e.fillStyle=I,e.lineWidth=3,e.strokeText(j,z+5,x+J),e.fillText(j,z+5,x+J)))}z=Math.round(new Date(P,N-1,C,0,0,0).getTime()*v+Z),z>0&&t.width>z&&(e.strokeStyle=F,e.lineWidth=1,e.beginPath(),e.moveTo(z,-1),e.lineTo(z,x+2*J+4),e.stroke(),a&&U>20&&(e.strokeStyle=s.colors.background,e.fillStyle=E,e.lineWidth=3,e.strokeText(C+".",z+5,x+2*J),e.fillText(C+".",z+5,x+2*J)))}z=Math.round(new Date(P,N-1,1,0,0,0).getTime()*v+Z),z>0&&t.width>z&&(e.strokeStyle=R,e.lineWidth=1,e.beginPath(),e.moveTo(z,-1),e.lineTo(z,t.height+2),e.stroke(),a&&L&&(e.strokeStyle=s.colors.background,e.fillStyle=L,e.lineWidth=3,e.strokeText(this._monthName(N)+" "+P,z+5,x+3*J),e.fillText(this._monthName(N)+" "+P,z+5,x+3*J)))}z=Math.round(new Date(P,0,1,0,0,0).getTime()*v+Z),z>0&&t.width>z&&(e.strokeStyle=K,e.lineWidth=1,e.beginPath(),e.moveTo(z,-1),e.lineTo(z,t.height+2),e.stroke(),a&&V&&(e.strokeStyle=s.colors.background,e.fillStyle=V,e.lineWidth=3,e.strokeText(P,z+5,x+3*J),e.fillText(P,z+5,x+3*J)))}if(a){e.lineWidth=1,e.strokeStyle=s.colors.scale3;var O=this._getScala(m,d);O.forEach(function(a){var i=Math.round(a*w+S);i>12&&x+12>=i&&(e.beginPath(),e.moveTo(-1,i),e.lineTo(t.width+2,i),e.stroke())})}if(s.datafields.forEach(function(t,i){if(s.lines)if(1==n.length){e.fillStyle=s.linecolors[i],e.beginPath();var o=n[0].v[i]*w+S,r=n[0].d*v+Z,c=2;a||(c=1),e.arc(r,o,c,0,2*Math.PI,!1),e.fill()}else{e.strokeStyle=s.linecolors[i],e.lineCap="round",e.lineWidth=a?2:1,e.beginPath();var l=0,h=0;n.forEach(function(t,a){if("number"==typeof t.v[i]){var n=t.v[i]*w+S,o=t.d*v+Z;if(0===a)e.moveTo(o,n);else if(s.smooth){var r=s.smooth*((o-l)/2);e.bezierCurveTo(l+r,h,o-r,n,o,n)}else e.lineTo(o,n);l=o,h=n}}),e.stroke()}(a&&s.lines&&s.dots||!s.lines&&s.dots)&&(e.fillStyle=s.dotcolors[i],n.forEach(function(t){e.beginPath();var n=t.v[i]*w+S,o=t.d*v+Z,r=s.dotsize;a||(r=Math.floor(s.dotsize/2),1>r&&(r=1)),e.arc(o,n,r,0,2*Math.PI,!1),e.fill()}))}),a){e.lineWidth=4,e.fillStyle=s.colors.scale2,e.strokeStyle=s.colors.background;var H=s.unit?" "+s.unit:"";O.forEach(function(t){var a=Math.round(t*w+S);a>12&&x+12>=a&&(e.strokeText(t+H,5,a-5),e.fillText(t+H,5,a-5))})}},_monthName:function(t){return s.monthnames[t-1]},_drawSOverlay:function(t,e){e.clearRect(-1,-1,t.width+2,t.height+2),e.fillStyle=s.colors.overlay,e.globalAlpha=s.colors.overlayOpacity,e.fillRect(-1,-1,t.width+2,t.height+2),e.globalAlpha=1;var a=t.width/(this._maxT-this._minT),i=-(this._minT*t.width)/(this._maxT-this._minT),n=Math.round(this._actFrom*a+i),o=Math.round(this._actTo*a+i);e.clearRect(n,-1,o-n-1,t.height+2),e.strokeStyle=s.colors.overlayBorder,e.lineWidth=1,e.strokeRect(n,0,o-n-1,t.height-1)},_getScala:function(t,e){var a=e-t,i=4,s=a/i,n=Math.floor(Math.log(s)/Math.LN10),o=Math.floor(t/Math.pow(10,n+1))*Math.pow(10,n+1),r=Math.pow(10,n+1);i>Math.floor(a/r)+1&&(r=.5*r),i>Math.floor(a/r)+1&&(r=.5*r),i>Math.floor(a/r)+1&&(r=.5*r);for(var c=[],l=o;e+3*r>=l;l+=r)c.push(l);return c}};return n._init()?n:!1};