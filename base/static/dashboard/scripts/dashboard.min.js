!function(){"use strict";function a(){$(document).ready(reform.widgets.map),$(document).ready(reform.widgets.paginators),$(document).ready(reform.widgets.search),reform.widgets.charts.reportsByDate(),reform.widgets.charts.violationsByCategory(),reform.widgets.charts.violationsByVictimGender(),reform.widgets.charts.violationsByVictimEducation(),reform.widgets.charts.violationsByFeatures()}reform||(window.reform={data:{},urls:{},widgets:{}}),reform.widgets.map=function(){var a=reform.widgets.map=L.map("ui-timeline-map");a.setView([34.161818161230386,9.3603515625],5),a.setMaxBounds(a.getBounds()),a.scrollWheelZoom.disable(),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png").addTo(a);var b=L.AwesomeMarkers.icon({icon:"flag",markerColor:"red"}),c=L.AwesomeMarkers.icon({icon:"star",markerColor:"green"}),d=new L.MarkerClusterGroup;d.addLayers(reform.data.violationsLocations.map(function(a){var c=L.marker(L.latLng(a.latitude,a.longitude),{title:a.category__definition,icon:b});return c.bindPopup('<a href="'+reform.urls.violationView.replace("0",a.pk)+'" target="_blank">'+a.category__definition+"</a>"),c})),d.addLayers(reform.data.appreciationsLocations.map(function(a){var b=L.marker(L.latLng(a.latitude,a.longitude),{title:a.category__definition,icon:c});return b.bindPopup('<a href="'+reform.urls.appreciationView.replace("0",a.pk)+'" target="_blank">'+a.category__definition+"</a>"),b})),a.addLayer(d)},reform.widgets.geosearch=function(){},reform.widgets.paginators=function(){function a(a){a.find(".ui-timeline-story-locator").on("click",function(a){a.stopPropagation(),a.preventDefault();var b=$(a.target).closest("li"),c=new L.LatLng(b.data("latitude"),b.data("longitude"));reform.widgets.map.setView(c,20),$.scrollTo(reform.widgets.map._container,500,{axis:"y",offset:{top:-100}})}),a.tooltip({selector:"[data-toggle=tooltip]",container:"body"})}function b(a,b){a.find(".ui-timeline-story-link").on("click",function(a){a.stopPropagation(),a.preventDefault();var c=$(a.target).closest("a"),d=c.attr("href");b.find(".modal-footer .ui-more").attr("href",d),$.get(d+"/partial").done(function(a){b.find(".modal-body").html(a),b.modal("show")})})}function c(c,d){return function(e,f){reform.widgets.paginate(c,e,f,function(c){a(c),b(c,d)})}}function d(a,b,c){return function(){a.block(),$.getJSON(c+".json").done(function(d){console.log(d),a.html(d.html),b(d,c),a.unblock()})}}var e=$("#ui-violations-timeline-list"),f=e.find(".ui-list"),g=c(f,$("#ui-violation-view-modal")),h=d(f,g,reform.urls.violationsDashboard);g(reform.data.violationsPagination,reform.urls.violationsDashboard),reform.widgets.paginateSearch(e,reform.urls.violationsSearch,g,h);var i=$("#ui-appreciations-timeline-list"),j=i.find(".ui-list"),k=c(j,$("#ui-appreciation-view-modal")),l=d(j,k,reform.urls.appreciationsDashboard);k(reform.data.appreciationsPagination,reform.urls.appreciationsDashboard),reform.widgets.paginateSearch(i,reform.urls.appreciationsSearch,k,l)},reform.widgets.charts={},reform.widgets.charts.reportsByDate=function(){var a,b,c,d=[];a={name:"Violations",color:"#c13c2d",data:[]},reform.data.violationsByDate.forEach(function(b){a.data.push([new Date(b.date).getTime(),b.count])}),a.data.push([(new Date).getTime(),0]),d.push(a),b=a.data[0][0],c=a.data[a.data.length-1][0],a={name:"Appreciations",color:"#28b262",data:[]},reform.data.appreciationsByDate.forEach(function(b){a.data.push([new Date(b.date).getTime(),b.count])}),(!a.data[0]||a.data[0][0]>b)&&a.data.unshift([b,0]),(!a.data[a.data.length-1]||a.data[a.data.length-1][0]<c)&&a.data.push([c,0]),d.push(a),$(document).ready(function(){$("#ui-reports-by-date-chart").highcharts({chart:{type:"line",zoomType:"x"},title:{text:"Violations/Appreciations by date"},subtitle:{text:void 0===document.ontouchstart?"Click and drag in the plot area to zoom in":"Pinch the chart to zoom in"},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b",year:"%b"}},yAxis:{title:{text:"Violations/Appreciations Number"},min:0},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+Highcharts.dateFormat("%e. %b",this.x)+": "+this.y+" violations/appreciations"}},series:d,credits:{enabled:!1}})})},reform.widgets.charts.violationsByCategory=function(){var a=reform.data.violationsByCategory.map(function(a){return[a.label,a.count]});$(document).ready(function(){$("#ui-stats-categories-chart").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Distribution by violation category"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{cursor:"pointer",dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!0}},series:[{type:"pie",name:"Victim's ategory share",data:a}],credits:{enabled:!1}})})},reform.widgets.charts.violationsByVictimGender=function(){var a=reform.data.violationsByVictimGender.map(function(a){return[a.label,a.count]});$(document).ready(function(){$("#ui-stats-victim-gender-chart").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Distribution by victim's gender"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{cursor:"pointer",dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!0}},series:[{type:"pie",name:"Victim's gender share",data:a}],credits:{enabled:!1}})})},reform.widgets.charts.violationsByVictimEducation=function(){var a=reform.data.violationsByVictimEducation.map(function(a){return[a.label,a.count]});$(document).ready(function(){$("#ui-stats-victim-education-chart").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Distribution by victim's education"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{cursor:"pointer",dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!0}},series:[{type:"pie",name:"Victim's education share",data:a}],credits:{enabled:!1}})})},reform.widgets.charts.violationsByFeatures=function(){var a=reform.data.violationsFeatures.filter(function(a){return a.selectable}).map(function(a){return a.definition}),b=[];b.length=a.length,a.forEach(function(a,c){b[c]=0}),reform.data.violationsByFeature.forEach(function(c){var d=a.indexOf(c.label);d>=0&&(b[d]=c.count)}),a.unshift("All"),b.unshift(reform.data.violationsPagination.count),$(document).ready(function(){$("#ui-stats-features-chart").highcharts({chart:{type:"bar"},title:{text:"Violations by Features"},legend:{enabled:!1},xAxis:{categories:a,title:{text:null}},yAxis:{min:0,title:{text:"Number of Violations",align:"high"},labels:{overflow:"justify"}},tooltip:{valueSuffix:" violations"},plotOptions:{bar:{dataLabels:{enabled:!0}}},series:[{data:b}],credits:{enabled:!1}})})},a()}();
//# sourceMappingURL=/static/dashboard/scripts/dashboard.min.js.map