"use strict";reform.widgets.map=function(){var a=reform.widgets.map=L.map("ui-timeline-map");a.setView([34.161818161230386,9.3603515625],5),a.setMaxBounds(a.getBounds()),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png").addTo(a);var b=L.AwesomeMarkers.icon({icon:"flag",markerColor:"red"}),c=L.AwesomeMarkers.icon({icon:"star",markerColor:"green"}),d=new L.MarkerClusterGroup;d.addLayers(reform.data.incidentsLocations.map(function(a){var c=L.marker(L.latLng(a.latitude,a.longitude),{title:a.category__definition,icon:b});return c.bindPopup('<a href="'+reform.urls.incidentView.replace("0",a.pk)+'" target="_blank">'+a.category__definition+"</a>"),c})),d.addLayers(reform.data.thanksLocations.map(function(a){var b=L.marker(L.latLng(a.latitude,a.longitude),{title:a.category__definition,icon:c});return b.bindPopup('<a href="'+reform.urls.thankView.replace("0",a.pk)+'" target="_blank">'+a.category__definition+"</a>"),b})),a.addLayer(d)},$(document).ready(reform.widgets.map),reform.widgets.geosearch=function(){},$(document).ready(reform.widgets.geosearch),reform.widgets.timeline=function(){function a(){f.find(".ui-timeline-story-locator").on("click",function(a){a.stopPropagation(),a.preventDefault(),console.log(d,a.target,a.currentTarget,a.relatedTarget,a.delegateTarget);var b=$(a.target).closest("li"),c=new L.LatLng(b.data("latitude"),b.data("longitude"));reform.widgets.map.setView(c,12)})}function b(){h.html(String(g.current)+" / "+String(g.pages)),i.off("click"),j.off("click"),k.off("click"),l.off("click"),1==g.current?(i.closest("li").addClass("disabled"),i.on("click",function(a){a.stopPropagation(),a.preventDefault()}),k.closest("li").addClass("disabled"),k.on("click",function(a){a.stopPropagation(),a.preventDefault()})):(i.closest("li").removeClass("disabled"),i.on("click",function(a){a.stopPropagation(),a.preventDefault(),c(1)}),k.closest("li").removeClass("disabled"),k.on("click",function(a){a.stopPropagation(),a.preventDefault(),c(g.current-1)})),g.current==g.pages?(l.closest("li").addClass("disabled"),l.on("click",function(a){a.stopPropagation(),a.preventDefault()}),j.closest("li").addClass("disabled"),j.on("click",function(a){a.stopPropagation(),a.preventDefault()})):(l.closest("li").removeClass("disabled"),l.on("click",function(a){a.stopPropagation(),a.preventDefault(),c(g.current+1)}),j.closest("li").removeClass("disabled"),j.on("click",function(a){a.stopPropagation(),a.preventDefault(),c("last")}))}function c(c){$.get("/reports/dashboard.json?page="+c).done(function(a){console.log(arguments,g),g.current=a.current,f.html(a.html)}).done(b).done(function(){f.unblock()}).done(a),f.block({message:"Loading ..."})}var d,e=reform.widgets.timeline,f=e.list=$("#ui-timeline-list");$(a);var g=reform.data.timeline,h=e.paginationIndicator=$("#ui-timeline-pagination-indicator"),i=e.paginationFirst=$("#ui-timeline-pagination-first"),j=e.paginationLast=$("#ui-timeline-pagination-last"),k=e.paginationPrevious=$("#ui-timeline-pagination-previous"),l=e.paginationNext=$("#ui-timeline-pagination-next");$(b),e.showPage=c},$(document).ready(reform.widgets.timeline),!function(){var a,b,c,d=[];a={name:"Incidents",color:"#c13c2d",data:[]},reform.data.incidentsByDate.forEach(function(b){a.data.push([new Date(b.date).getTime(),b.count])}),a.data.push([(new Date).getTime(),0]),d.push(a),b=a.data[0][0],c=a.data[a.data.length-1][0],a={name:"Thanks",color:"#28b262",data:[]},reform.data.thanksByDate.forEach(function(b){a.data.push([new Date(b.date).getTime(),b.count])}),(!a.data[0]||a.data[0][0]>b)&&a.data.unshift([b,0]),(!a.data[a.data.length-1]||a.data[a.data.length-1][0]<c)&&a.data.push([c,0]),d.push(a),$(document).ready(function(){console.log(d),$("#ui-reports-dates-chart").highcharts({chart:{type:"line",zoomType:"x"},title:{text:"Incidents/Thanks by date"},subtitle:{text:void 0===document.ontouchstart?"Click and drag in the plot area to zoom in":"Pinch the chart to zoom in"},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b",year:"%b"}},yAxis:{title:{text:"Incidents/Thanks Number"},min:0},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+Highcharts.dateFormat("%e. %b",this.x)+": "+this.y+" incidents"}},series:d,credits:{enabled:!1}})})}(),!function(){var a=reform.data.incidentsByCategory.map(function(a){return[a.label,a.count]});$(document).ready(function(){$("#ui-stats-categories-chart").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Distribution by incident category"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"}}},series:[{type:"pie",name:"Category share",data:a}],credits:{enabled:!1}})})}(),!function(){var a=reform.data.incidentsByVictimGender.map(function(a){return[a.label,a.count]});$(document).ready(function(){$("#ui-stats-victim-gender-chart").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Distribution by victim's gender"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"}}},series:[{type:"pie",name:"Victim's gender share",data:a}],credits:{enabled:!1}})})}(),!function(){var a=reform.data.incidentsByVictimEducation.map(function(a){return[a.label,a.count]});$(document).ready(function(){$("#ui-stats-victim-education-chart").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Distribution by victim's education"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"}}},series:[{type:"pie",name:"Victim's educqtion share",data:a}],credits:{enabled:!1}})})}(),!function(){var a=reform.data.incidentsFeatures.slice(0),b=[];b.length=a.length,a.forEach(function(a,c){b[c]=0}),reform.data.incidentsByFeature.forEach(function(c){var d=a.indexOf(c.label);d>=0&&(b[d]=c.count)}),a.unshift("All"),b.unshift(reform.data.timeline.count),$(document).ready(function(){$("#ui-stats-features-chart").highcharts({chart:{type:"bar"},title:{text:"Incidents by Features"},legend:{enabled:!1},xAxis:{categories:a,title:{text:null}},yAxis:{min:0,title:{text:"Number of Incidents",align:"high"},labels:{overflow:"justify"}},tooltip:{valueSuffix:" incidents"},plotOptions:{bar:{dataLabels:{enabled:!0}}},series:[{data:b}],credits:{enabled:!1}})})}();
//# sourceMappingURL=/static/reports/scripts/dashboard.min.js.map