{% extends "layouts/default.html" %}

{% load static custom compress %}

{% block view_title %}Reports Dashboard | {% endblock %}

{% block view_content %}

	<div class="container">

		<div class="page-header">
			<h1 class="text-center">Reports Dashboard</h1>
		</div>

		<div class="hero-unit clearfix" style="padding: 20px 40px;">
			{% if report_list %}
			<div class="pull-left" style="margin: 0;">
				{% with report=report_list.0 %}
				<div>
					<h2 style="margin-top: 0;">Latest Report</h2>
					<span class="label victim"><i class="icon-user"></i> {{report.victim}}</span>
					has been a victim of
					<span class="label category">{{report.category}}</span>
					happened in
					<span class="label location"><i class="icon-map-marker"></i> {{report.location_text}}</span>
					on
					<span class="label datetime"><i class="icon-calendar"></i> {{report.datetime}}</span>
					{% if report.is_verified %}<span class="badge badge-success">Verified <i class="icon-ok"></i></span>{% endif %}
					{% comment %}
					{% if report.is_closed %}<span class="badge badge-important">Closed <i class="icon-lock"></i></span>{% endif %}
					{% endcomment %}
					<a class="btn btn-quiet" href="{% url 'reports:view' report.id %}" target="_blank" title="Click to view report">
						<i class="icon-link"></i>
					</a>
				</div>
				{% endwith %}
			</div>
			{% else %}
			<div class="pull-left" style="margin: 0;">
				<h2>There is no reports!</h2>
			</div>
			{% endif %}
			<a class="btn btn-danger btn-large pull-right" href="{% url 'reports:submit' %}"><i class="icon-plus"></i> Report Indecent</a>
		</div>

		{% if report_list %}
		<div class="well">

			<div class="container-fluid">

				<!--
				<div class="row-fluid">
					<div class="span12">
						<div id="ui-reports-dates-chart" style="height: 300px;"></div>
					</div>
				</div>
				-->

				<div class="row-fluid">
					<div class="span12">
						<div id="ui-reports-dates-chart-highcharts" style="height: 300px;"></div>
					</div>
				</div>

				<div class="row-fluid">
					<div class="span6" style="margin-top: 20px;">
						<!--<h2>Map</h2>-->

						<div id="ui-timeline-map" class="ui-timeline-map" style="width:100%; height: 300px"></div>

						<div style="margin: 0; margin-top: 20px;">
						<!--<h2>Timeline</h2>-->
						<div id="ui-timeline-reports-list" class="ui-timeline-list">
							<div class="row-fluid">
								<!--
								<div class="span12">
									<input type="text" placeholder="Search" class="search input-block-level">
								</div>
								-->
								<div class="span4" style="display: none;">
									<div class="pagination" style="margin: 0;">
										<ul>
											<!--<li class="disabled"><a href="#">&larr;</a></li>-->
											<li class="previous"><a href="javascript:void(0)" onclick="reform.widgets.timeline.showPreviousPage()">&larr;</a></li>
											<!--
											<li class="active"><a href="#">1</a></li>
											<li><a href="#">2</a></li>
											<li><a href="#">3</a></li>
											-->
											<li><span id="ui-timeline-pagination-indicator_"></span></li>
											<li class="next"><a href="javascript:void(0)" onclick="reform.widgets.timeline.showNextPage()">&rarr;</a></li>
										</ul>
									</div>
								</div>
							</div>

							<ul id="ui-timeline-list" class="list list-hover">
								{% include "reports/dashbload_reports_list.html" %}
							</ul>

							<div class="pagination pagination-centered">
								<ul>

									<li class="{% if current == 1 %}disabled{% endif %}">
										<a id="ui-timeline-pagination-first" class="ui-timeline-pagination-control" href="{{request.path}}?page=1"><i class="icon-arrow-left"></i> First</a>
									</li>

									<li class="{% if current == 1 %}disabled{% endif %}">
										<a id="ui-timeline-pagination-previous" class="ui-timeline-pagination-control" href="{{request.path}}?page={{current}}"><i class="icon-arrow-left"></i> Previous</a>
									</li>

									{% comment %}
									{% for page in pages|times %}
									<li{% if forloop.counter == current  %} class="active"{% endif %}><a href="{{request.path}}?page={{forloop.counter}}">{{forloop.counter}}</a></li>
									{% endfor %}
									{% endcomment %}

									<li><span id="ui-timeline-pagination-indicator">{{current}} / {{pages}}</span></li>

									<li class="{% if current == pages %}disabled{% endif %}">
										<a id="ui-timeline-pagination-next" class="ui-timeline-pagination-control" href="{{request.path}}?page={{ current|add:1 }}">Next <i class="icon-arrow-right"></i></a>
									</li>

									<li class="{% if current == pages %}disabled{% endif %}">
										<a id="ui-timeline-pagination-last" class="ui-timeline-pagination-control" href="{{request.path}}?page=last">Last <i class="icon-arrow-right"></i></a>
									</li>
								</ul>
							</div>
						</div>
						</div>

					</div>
					<div class="span6" style="margin-top: 20px;">
						<!--
						<div id="ui-stats-features-chart"></div>
						<h3 class="text-center">Features</h3>
						-->
						<div id="ui-stats-features-chart-highcharts"></div>
					</div>
				</div>

				{% if report_list.count > 0 %}

				<div class="row-fluid">
					<div class="span4" style="margin-top: 20px;">
						<!--
						<div id="ui-stats-categories-chart"></div>
						<h3 class="text-center">Distribution by incident category</h3>
						-->
						<div id="ui-stats-categories-chart-highcharts"></div>
					</div>
					<div class="span4" style="margin-top: 20px;">
						<!--
						<div id="ui-stats-victim-gender-chart"></div>
						<h3 class="text-center">Distribution by victim's gender</h3>
						-->
						<div id="ui-stats-victim-gender-chart-highcharts"></div>
					</div>
					<div class="span4" style="margin-top: 20px;">
						<!--
						<div id="ui-stats-victim-education-chart"></div>
						<h3 class="text-center">Distribution by victim's education</h3>
						-->
						<div id="ui-stats-victim-education-chart-highcharts"></div>
					</div>
				</div>

				<div class="row-fluid">
					<div class="span4">
						<div id="ui-stats-categories-list"></div>
					</div>
					<div class="span4">
						<div id="ui-stats-features-list"></div>
					</div>
					<div class="span4">
						<div id="ui-stats-victim-gender-list"></div>
					</div>
				</div>

				{% else %}
				<div class="row-fluid">
					<div class="span12">
						No statistics either!
					</div>
				</div>
				{% endif %}

		</div>
		{% endif %}

	</div>

{% endblock %}

{% block view_styles %}
	{% compress css %}
	<link rel="stylesheet" href="{% static 'components/leaflet/dist/leaflet.css'%}" />
	{% comment %}
	<link rel="stylesheet" href="{% static 'components/morris.js/morris.css'%}" />
	<link rel="stylesheet" href="{% static 'components/morris.js/morris.css'%}" />
	{% endcomment %}
	{% endcompress %}
	<!--[if lte IE 8]>
	<link rel="stylesheet" href="{% static 'components/leaflet/dist/leaflet.ie.css'%}" />
	<![endif]-->
	{% compress css %}
	<link rel="stylesheet" href="{% static 'reports/styles/dashboard.css'%}" />
	{% endcompress %}
{% endblock %}

{% block view_scripts %}
	{% compress js %}
	<script src="{% static 'components/blockui/jquery.blockUI.js' %}"></script>
	<script src="{% static 'components/leaflet/dist/leaflet.js' %}"></script>
	{% comment %}
	<script src="{% static 'components/raphael/raphael.js' %}"></script>
	<script src="{% static 'components/morris.js/morris.js' %}"></script>
	{% endcomment %}
	<script src="{% static 'components/highcharts.com/js/highcharts.src.js' %}"></script>
	<script src="{% static 'components/highcharts.com/js/modules/exporting.src.js' %}"></script>
	{% endcompress %}

	{% if report_list %}
	<script type="text/javascript">
		reform.data.reportsByCategory = {{reports_by_category|json}}
		reform.data.reportsByFeature = {{reports_by_feature|json}}
		reform.data.reportsByVictimGender = {{reports_by_victim_gender|json}}
		reform.data.reportsByVictimEducation = {{reports_by_victim_education|json}}
		reform.data.reportsByDate = {{reports_by_date|json}}
		reform.data.categories = {{categories|json}}
		reform.data.features = {{features|json}}
		reform.data.timeline = {
			pages: {{pages|json}},
			current: {{current|json}},
			count: {{count|json}},
		};
	</script>
	{% compress js %}
	<script src="{% static 'reports/scripts/dashboard.js' %}"></script>
	{% endcompress %}
	{% endif %}

{% endblock %}
