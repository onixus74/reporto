{% extends "layouts/default.html" %}

{% load static json compress %}
{% block view_title %}Reports Dashboard | {% endblock %}

{% block view_content %}

	<div class="container">

		<!--
		<div class="page-header">
			<h1>Reports Dashboard</h1>
		</div>
		-->

		<div class="hero-unit clearfix" style="padding: 40px;">
			<h1 class="pull-left" style="margin-top: 0;">Reports Dashboard</h1>
			<a class="btn btn-danger btn-large pull-right" href="{% url 'reports:submit' %}"><i class="icon-plus"></i> Report Indecent</a>
		</div>



		<div class="well">

			<div class="container-fluid">

				<div class="row-fluid">
					<div class="span6">
						<h2>Map</h2>

						<div id="ui-timeline-map" style="width:100%; height: 300px"></div>

					</div>
					<div class="span6">
						<h2>Timeline</h2>

						<ul class="list list-hover">
						{% for report in report_list %}
							<li class="ui-timeline-story" data-latlng="{{report.location}}">
								<span class="label">{{report.victim}}</span> has been a victim of <span class="label">{{report.category}}</span>
								happened in <span class="label">{{report.location_text}}</span>
								on <span class="label"><a href="{% url 'reports:view' report.id %}">{{report.datetime}}</a><span>
								{% if report.is_verified %}<span class="badge badge-success">Verified <i class="icon-ok"></i></span>{% endif %}
								{% if report.is_closed %}<span class="badge badge-important">Closed <i class="icon-lock"></i></span>{% endif %}
							</li>
						{% empty %}
						<li id="ui-no-reports">No reports!</li>
						{% endfor %}
					</ul>

					</div>
				</div>

				<div class="row-fluid">
					<div class="span12">
						<h2>Stats</h2>
						{% if report_list.count > 0 %}

						<div class="row-fluid">
							<div class="offset2 span8">
								<div id="ui-reports-dates-chart"></div>
							</div>
						</div>

						<div class="row-fluid">
							<div class="span4">
								<div id="ui-stats-categories-chart" class=""></div>
								<h3 class="text-center">Distribution by incident category</h3>
							</div>
							<div class="span4">
								<div id="ui-stats-features-chart" class=""></div>
								<h3 class="text-center">Distribution by features</h3>
							</div>
							<div class="span4">
								<div id="ui-stats-victim-gender-chart" class=""></div>
								<h3 class="text-center">Distribution by victim's gender</h3>
							</div>
						</div>

						{% else %}
						No statistics either!
						{% endif %}
					</div>
				</div>

		</div>

	</div>

{% endblock %}

{% block view_styles %}
	{% compress css %}
	<link rel="stylesheet" href="{% static 'components/leaflet/dist/leaflet.css'%}" />
	<link rel="stylesheet" href="{% static 'components/morris.js/morris.css'%}" />
	{% endcompress %}
	<!--[if lte IE 8]>
	<link rel="stylesheet" href="{% static 'components/leaflet/dist/leaflet.ie.css'%}" />
	<![endif]-->
{% endblock %}

{% block view_scripts %}
	{% compress js %}
	<script src="{% static 'components/leaflet/dist/leaflet.js' %}"></script>
	<script src="{% static 'components/raphael/raphael.js' %}"></script>
	<script src="{% static 'components/morris.js/morris.js' %}"></script>
	{% endcompress %}
	<script type="text/javascript">
		reform.data.reportsByCategory = {{reports_by_category|json}}
		reform.data.reportsByFeature = {{reports_by_feature|json}}
		reform.data.reportsByVictimGender = {{reports_by_victim_gender|json}}
		reform.data.reportsByDate = {{reports_by_date|json}}
	</script>
	{% compress js %}
	<script src="{% static 'reports/scripts/dashboard.js' %}"></script>
	{% endcompress %}
{% endblock %}
