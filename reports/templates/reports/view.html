{% extends "layouts/default.html" %}

{% load static json thumbnail compress %}

{% block view_title %}Report Details | {% endblock %}

{% block view_content %}
<div class="container">

	<div class="page-header">
		<h1>Report View<small></small></h1>
	</div>

	<div class="well">

		<div class="container-fluid">

			<div class="row-fluid">
				<div class="offset2 span8">
					<hr>
					<h2 class="text-center">
						{{report.category}} on {{report.datetime}} at {{report.location_text}}
						{% if report.is_verified %}<span class="badge badge-success">Verified <i class="icon-ok"></i></span>{% endif %}
						{% if report.is_closed %}<span class="badge badge-important">Closed <i class="icon-lock"></i></span>{% endif %}
					</h2>
				</div>
			</div>

			<div class="row-fluid">
				<div class="offset2 span8">
					<div id="map" style="width:100%; height: 300px"></div>
					<!--<p class="text-center">{{report.location_text}}</p>-->
				</div>
			</div>

			<div class="row-fluid">
				<div class="span6">
					<hr>
					<h2>Victim</h2>
					<a href="{{report.victim.get_absolute_url}}">{{report.victim}}</a>
				</div>
				<div class="span6">
					<hr>
					<h2>Aggressor</h2>
					{{report.aggressor}}
				</div>
			</div>

			<div class="row-fluid">
				<div class="span6">
					<hr>
					<h2>Description</h2>
					{{report.description}}
				</div>
				<div class="span6">
					<hr>
					<h2>Evidence</h2>{% get_media_prefix as MEDIA_PREFIX %}
					{% if report.media.count %}
					<ul class="thumbnails">
						{% for media in report.media.all %}
						<li class="span4_" style="display: inline-block; width: auto;">
							<a class="thumbnail fancybox" href="{{media.file.url}}" target="_blank" rel="group">
								<img src="{{ media.file|thumbnail_url:'report_comment' }}" alt="" style="height: 100px; width: auto;">
							</a>
						</li>
						{% endfor %}
					</ul>
					{% else %}
					<span>No attachments!</span>
					{% endif %}
				</div>
			</div>

			<div class="row-fluid">
				<div class="offset2 span8">
					<hr>
					<h2>Features</h2>
					<ul class="inline">
					{% for feature in report.features.all  %}
						<li><a href="{{feature.get_absolute_url}}">{{feature}}</a></li>
					{% endfor %}
					</ul>
				</div>
			</div>

			<div class="row-fluid">
				<div class="offset1 span10">
					<hr>
					<h2>Comments</h2>

					<ul id="ui-comments" class="list">
						{% if report.comments.count %}
						{% for comment in report.comments.all  %}
							{% include "reports/view_comment.html" %}
						{% endfor %}
						{% else %}
						<li id="ui-no-comments">No comments!</li>
						{% endif %}
					</ul>
				</div>
			</div>
			<div class="row-fluid">
				<fieldset id="ui-comments-area">
					<div class="offset1 span8">
						<textarea id="ui-add-comment-content" class="input-block-level" placeholder="Add new comment" required></textarea>
						<input id="ui-add-comment-attachment" type="file">
					</div>
					<div class="span2">
						<button id="ui-add-update-comment-button" class="btn-block btn btn-primary" type="button"><i class="icon-plus"></i> Update</button>
						<button id="ui-add-correction-comment-button" class="btn-block btn btn-danger" type="button"><i class="icon-plus"></i> Correction</button>
					</div>
				</fieldset>
			</div>

		</div>

	</div>

</div>
{% endblock %}

{% block view_styles %}

	{% compress css %}
	<!-- Map -->
	<link rel="stylesheet" href="{% static 'components/leaflet/dist/leaflet.css' %}" />
	<!-- Lightbox -->
	<link rel="stylesheet" href="{% static 'components/fancybox/source/jquery.fancybox.css' %}" type="text/css" media="screen" />
	{% endcompress %}

	<link rel="stylesheet" href="{% static 'reports/styles/view.css'%}" />

{% endblock %}

{% block view_scripts %}

	{% compress js %}
	<!-- Map -->
	<script src="{% static 'components/leaflet/dist/leaflet.js' %}"></script>
	<!-- Lightbox -->
	<script type="text/javascript" src="{% static 'components/fancybox/source/jquery.fancybox.js' %}"></script>
	{% endcompress %}

	<script type="text/javascript">
		reform.urls = {
			'verify': "{% url 'reports:verify' report.id %}",
			'close': "{% url 'reports:close' report.id %}",
			'comment': "{% url 'reports:comment' report.id %}"
		};
		reform.data.report = {{report|json}}
		//$.post(reform.urls.verify, {csrfmiddlewaretoken: csrf_token}).done(function(data){console.log(data)})
		/*
		$.ajaxSetup({
			beforeSend: function(xhr, settings) {
				xhr.setRequestHeader("X-CSRFToken", csrf_token);
			}
		});
		*/
		$(function(){
			$(".fancybox").fancybox();
		})
	</script>

	<script src="{% static 'reports/scripts/view.js' %}"></script>

{% endblock %}
