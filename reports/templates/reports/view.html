{% extends "layouts/default.html" %}

{% load static custom thumbnail compress %}

{% block view_title %}Report Details | {% endblock %}

{% block view_content %}
<div class="container">

	<div class="page-header">
		<h1>Report View<small></small></h1>
	</div>

	<div class="well">

		<div class="container-fluid">

			<div class="row-fluid">
				<div class="offset2 span8">
					<hr>
					<h2 class="text-center">
						{{report.category}} on {{report.datetime}} at {{report.location_text}}
						{% if report.is_verified %}<span class="badge badge-success">Verified <i class="icon-ok"></i></span>{% endif %}
						{% comment %}
						{% if report.is_closed %}<span class="badge badge-important">Closed <i class="icon-lock"></i></span>{% endif %}
						{% endcomment %}
						{% if user.is_admin %}<a class="btn btn-warning" href="/admin/reports/report/{{report.id}}" target="_blank"><i class="icon-pencil"></i> Edit</a>{% endif %}
					</h2>
				</div>
			</div>

			<div class="row-fluid">
				<div class="offset2 span8">
					<div id="map" style="width:100%; height: 300px"></div>
					<!--<p class="text-center">{{report.location_text}}</p>-->
				</div>
			</div>

			<div class="row-fluid">
				<div class="span6">
					<hr>
					<h2><i class="icon-user"></i> Victim</h2>
					<dl class="dl-horizontal">
						<dt>Category</dt>
						<dd>{{report.victim.get_category_display}}</dd>
						<dt>Firstname</dt>
						<dd>{{report.victim.firstname}}</dd>
						<dt>Lastname</dt>
						<dd>{{report.victim.lastname}}</dd>
						<dt>Gender</dt>
						<dd>{{report.victim.get_gender_display}}</dd>
						<dt>Age</dt>
						<dd>{{report.victim.age}}</dd>
						<dt>Education</dt>
						<dd>{{report.victim.education}}</dd>
						<dt>Profession</dt>
						<dd>{{report.victim.profession}}</dd>
					</dl>
				</div>
				<div class="span6">
					<hr>
					<h2><i class="icon-male"></i> Aggressor</h2>
					{{report.aggressor}}
				</div>
			</div>

			<div class="row-fluid">
				<div class="span6">
					<hr>
					<h2><i class="icon-ellipsis-horizontal"></i> Description</h2>
					{{report.description}}
				</div>
				<div class="span6">
					<hr>
					<h2><i class="icon-picture"></i> Evidence</h2>{% get_media_prefix as MEDIA_PREFIX %}
					{% if report.media.count %}
					<ul class="thumbnails">
						{% for media in report.media.all %}
						<li class="span4_" style="display: inline-block; width: auto;">
							<a class="thumbnail fancybox" href="{{media.file.url}}" target="_blank" rel="group">
								<img src="{{ media.file|thumbnail_url:'report_comment' }}" alt="" style="height: 100px; width: auto;">
							</a>
						</li>
						{% endfor %}
					</ul>
					{% else %}
					<span>No attachments!</span>
					{% endif %}
				</div>
			</div>

			<div class="row-fluid">
				<div class="offset2 span8">
					<hr>
					<h2><i class="icon-tag"></i> Features</h2>
					<ul class="inline">
					{% for feature in report.features.all  %}
						<li><span class="label">{{feature}}</span></li>
					{% endfor %}
					</ul>
				</div>
			</div>

			<div class="row-fluid">
				<div class="offset1 span10">
					<hr>
					<h2><i class="icon-comments"></i> Comments</h2>

					<ul id="ui-comments" class="list">
						{% for comment in report.comments.all  %}
							{% include "reports/view_comment.html" %}
						{% empty %}
						<li id="ui-no-comments">No comments!</li>
						{% endfor %}
					</ul>
				</div>
			</div>
			<div class="row-fluid">
				<fieldset id="ui-comments-area">
					<div class="offset1 span4">
						<textarea id="ui-add-comment-content" class="input-block-level" placeholder="Add new comment" required></textarea>
						<input id="ui-add-comment-attachment" type="file" accept="image/*" hidden>
					</div>
					<div class="span4">
						<button class="btn btn-block" id="ui-add-comment-attachment-button">
							<i id="ui-comment-attachment-icon" class="icon-camera icon-3x"></i>
							<img id="ui-comment-attachment-image" style="width: 100%;" hidden>
						</button>
					</div>
					<div class="span2">
						<button id="ui-add-update-comment-button" class="btn btn-block btn-primary" type="button"><i class="icon-plus"></i> Update</button>
						<button id="ui-add-correction-comment-button" class="btn btn-block btn-danger" type="button"><i class="icon-plus"></i> Correction</button>
					</div>
				</fieldset>
			</div>

		</div>

	</div>

</div>
{% endblock %}

{% block view_styles %}

	{% compress css %}
	<!-- Map -->
	<link rel="stylesheet" href="{% static 'components/leaflet/dist/leaflet.css' %}" />
	<!-- Lightbox -->
	<link rel="stylesheet" href="{% static 'components/fancybox/source/jquery.fancybox.css' %}" type="text/css" media="screen" />
	{% endcompress %}

	{% compress css %}
	<link rel="stylesheet" href="{% static 'reports/styles/view.css'%}" />
	{% endcompress %}

{% endblock %}

{% block view_scripts %}

	{% compress js %}
	<!-- Map -->
	<script src="{% static 'components/leaflet/dist/leaflet.js' %}"></script>
	<!-- Lightbox -->
	<script type="text/javascript" src="{% static 'components/fancybox/source/jquery.fancybox.js' %}"></script>
	{% endcompress %}

	<script type="text/javascript">
		reform.urls = {
			'verify': "{% url 'reports:verify' report.id %}",
			'close': "{% url 'reports:close' report.id %}",
			'comment': "{% url 'reports:comment' report.id %}"
		};
		reform.data.report = {{report|json}}
		//$.post(reform.urls.verify, {csrfmiddlewaretoken: csrf_token}).done(function(data){console.log(data)})
		/*
		$.ajaxSetup({
			beforeSend: function(xhr, settings) {
				xhr.setRequestHeader("X-CSRFToken", csrf_token);
			}
		});
		*/
		$(function(){
			$(".fancybox").fancybox();
		})
	</script>

	{% compress js %}
	<script src="{% static 'reports/scripts/view.js' %}"></script>
	{% endcompress %}

{% endblock %}
